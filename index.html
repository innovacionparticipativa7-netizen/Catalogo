<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<meta charset="UTF-8">
<title>Catálogo de Premios IP</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 40px;
}

input, button {
  padding: 6px;
  margin: 4px 0;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 10px;
  text-align: center;
}

th {
  background-color: #f2f2f2;
}

img {
  width: 80px;
  border-radius: 6px;
}

.admin {
  background: #f9f9f9;
  padding: 10px;
  margin-top: 15px;
  border: 1px solid #ccc;
}
</style>
</head>

<body>

<h2>Catálogo de Premios IP</h2>

<input type="text" id="buscador" placeholder="Buscar producto..." onkeyup="buscar()">

<!-- LOGIN -->
<div class="admin">
  <h3>Acceso administrador</h3>
  <input type="password" id="password" placeholder="Contraseña">
  <button onclick="login()">Ingresar</button>
</div>
<style>  
.admin-login {
  position: fixed;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 4px;
}

.admin-login input {
  width: 90px;
  padding: 4px;
  font-size: 12px;
}

.admin-login button {
  padding: 4px 6px;
  font-size: 12px;
  cursor: pointer;
}
</style>

<!-- FORMULARIO -->
<div id="formulario" class="admin" style="display:none;">
  <h3>Agregar / Editar producto</h3>

  <input type="hidden" id="editIndex">

  <input type="text" id="descripcion" placeholder="Descripción"><br>
  <input type="number" id="disponible" placeholder="Disponible"><br>
  <input type="number" id="precio" placeholder="Punto IP"><br>
  <input type="text" id="imagen" placeholder="URL de la imagen"><br>

  <button onclick="guardarProducto()">Guardar</button>
  <button onclick="cancelarEdicion()">Cancelar</button>
</div>

<table id="tablaProductos">
<thead>
<tr>
  <th>Foto</th>
  <th>Descripción</th>
  <th>Disponible</th>
  <th>Punto IP</th>
  <th>Acciones</th>
</tr>
</thead>

<tbody id="listaProductos"></tbody>

</table>

<script>
const CONTRASENA = "1234";
let logeado = false;

function login() {
  if (document.getElementById("password").value === CONTRASENA) {
    logeado = true;
    document.getElementById("formulario").style.display = "block";
    alert("Acceso concedido");
  } else {
    alert("Contraseña incorrecta");
  }
}

function buscar() {
  let texto = buscador.value.toLowerCase();
  document.querySelectorAll("#tablaProductos tbody tr").forEach(fila => {
    fila.style.display = fila.textContent.toLowerCase().includes(texto) ? "" : "none";
  });
}

function guardarProducto() {
  if (!logeado) return;

  let d = descripcion.value;
  let disp = disponible.value;
  let p = precio.value;
  let img = imagen.value;
  let index = editIndex.value;

  if (!d || !disp || !p || !img) {
    alert("Completa todos los campos");
    return;
  }

  if (index === "") {
    let fila = tablaProductos.querySelector("tbody").insertRow();
    fila.innerHTML = crearFila(img, d, disp, p);
  } else {
    let fila = tablaProductos.rows[index];
    fila.cells[0].innerHTML = `<img src="${img}">`;
    fila.cells[1].innerText = d;
    fila.cells[2].innerText = disp;
    fila.cells[3].innerText = p;
  }

  limpiarFormulario();
}

function crearFila(img, d, disp, p) {
  return `
    <td><img src="${img}"></td>
    <td>${d}</td>
    <td>${disp}</td>
    <td>${p}</td>
    <td>
      <button onclick="editarProducto(this)">Editar</button>
      <button onclick="eliminarProducto(this)">Eliminar</button>
    </td>
  `;
}

function editarProducto(boton) {
  if (!logeado) {
    alert("Acceso restringido");
    return;
  }

  let fila = boton.closest("tr");
  editIndex.value = fila.rowIndex;

  descripcion.value = fila.cells[1].innerText;
  disponible.value = fila.cells[2].innerText;
  precio.value = fila.cells[3].innerText;
  imagen.value = fila.cells[0].querySelector("img").src;
}

function eliminarProducto(boton) {
  if (!logeado) {
    alert("Acceso restringido");
    return;
  }

  if (confirm("¿Eliminar producto?")) {
    boton.closest("tr").remove();
  }
}

function cancelarEdicion() {
  limpiarFormulario();
}

function limpiarFormulario() {
  descripcion.value = "";
  disponible.value = "";
  precio.value = "";
  imagen.value = "";
  editIndex.value = "";
}
</script>
<script>
/* CONFIGURACIÓN FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCfS-TI8g2KEUWQmCafvf-Ig4KtZa2o_W8",
    authDomain: "catalogo-ee5b7.firebaseapp.com",
    projectId: "catalogo-ee5b7",
    storageBucket: "catalogo-ee5b7.firebasestorage.app",
    messagingSenderId: "577362291946",
    appId: "1:577362291946:web:fe798c5e79e311a8967b93",
    measurementId: "G-614VMMXP8Z"
};

/* INICIALIZAR FIREBASE */
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* REFERENCIAS HTML */
const listaProductos = document.getElementById("listaProductos");

/* LEER PRODUCTOS EN TIEMPO REAL */
db.collection("productos").onSnapshot(snapshot => {
  listaProductos.innerHTML = "";
  snapshot.forEach(doc => {
    const p = doc.data();
    listaProductos.innerHTML += `
      <tr>
        <td><img src="${p.img}"></td>
        <td>${p.desc}</td>
        <td>${p.disp}</td>
        <td>${p.precio}</td>
        <td>
          <button onclick="editarProducto('${doc.id}')">Editar</button>
          <button onclick="eliminarProducto('${doc.id}')">Eliminar</button>
        </td>
      </tr>
    `;
  });
});
</script>

</body>
</html>



