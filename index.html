<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tienda de Premios IP</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; }

body {
  font-family: 'Inter', sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 30px;
}

.header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin-bottom: 30px;
}

.logo {
  width: 80px;
}

.titulo {
  font-size: 48px;
  font-weight: 800;
  color: #1e293b;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.tab {
  padding: 10px 16px;
  border-radius: 999px;
  background: white;
  border: 1px solid #ccc;
  cursor: pointer;
}

.tab.active {
  background: #2563eb;
  color: white;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
}

.search {
  padding: 10px;
  width: 260px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

.admin-login input, .admin-login button {
  padding: 8px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 20px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

.card img {
  width: 100%;
  height: 180px;
  object-fit: contain;
  cursor: pointer;
}

.badge {
  background: #111827;
  color: white;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
}

.admin-panel {
  background: white;
  padding: 20px;
  border-radius: 12px;
  margin: 20px 0;
  max-width: 500px;
}

.admin-only { display: none; }
.admin-mode .admin-only { display: table-cell; }

.tabla-usuarios {
  width: 100%;
  background: white;
  border-collapse: collapse;
}

.tabla-usuarios th, .tabla-usuarios td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
}

.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.8);
  justify-content: center;
  align-items: center;
}

.modal img {
  max-width: 90%;
  max-height: 90%;
}
</style>
</head>

<body>

<div class="header">
  <img src="logo.png" class="logo">
  <h1 class="titulo">Tienda de Premios IP</h1>
</div>

<div class="tabs">
  <button class="tab active" onclick="mostrarSeccion('premios', this)">üéÅ Premios</button>
  <button class="tab" onclick="mostrarSeccion('usuarios', this)">üë§ Usuarios</button>
</div>

<!-- ================= PREMIOS ================= -->
<div id="seccion-premios">
  <div class="top-bar">
    <input id="buscador" class="search" placeholder="Buscar premio..." onkeyup="renderProductos()">
    <div class="admin-login">
      <input type="password" id="password" placeholder="Admin">
      <button onclick="login()">OK</button>
    </div>
  </div>

  <div id="listaProductos" class="grid"></div>
</div>

<!-- ================= USUARIOS ================= -->
<div id="seccion-usuarios" style="display:none">

  <div id="formUsuarios" class="admin-panel" style="display:none">
    <input type="hidden" id="userId">
    <input id="controlUsuario" placeholder="N√∫mero de control">
    <input id="nombreUsuario" placeholder="Nombre">
    <input id="puntosAcumulados" type="number" placeholder="Puntos acumulados">
    <input id="puntosActuales" type="number" placeholder="Puntos actuales">
    <textarea id="comentariosUsuario" placeholder="Comentarios"></textarea>
    <button onclick="guardarUsuario()">Guardar</button>
    <button onclick="cancelarUsuario()">Cancelar</button>
  </div>

  <table class="tabla-usuarios">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Puntos</th>
        <th class="admin-only">Acumulados</th>
        <th class="admin-only">Comentarios</th>
        <th class="admin-only">Acciones</th>
      </tr>
    </thead>
    <tbody id="listaUsuarios"></tbody>
  </table>
</div>

<!-- MODAL -->
<div id="modal" class="modal" onclick="this.style.display='none'">
  <img id="modalImg">
</div>

<script>
/* ================= CONFIG ================= */
const CONTRASENA = "1234";
let logeado = false;

/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyCfS-TI8g2KEUWQmCafvf-Ig4KtZa2o_W8",
  authDomain: "catalogo-ee5b7.firebaseapp.com",
  projectId: "catalogo-ee5b7"
});

const db = firebase.firestore();

/* ================= LOGIN ================= */
function login() {
  if (password.value === CONTRASENA) {
    logeado = true;
    document.body.classList.add("admin-mode");
    document.getElementById("formUsuarios").style.display = "block";
    alert("Modo administrador activo");
  }
}

/* ================= PREMIOS ================= */
let productos = [];

db.collection("productos").onSnapshot(snap => {
  productos = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderProductos();
});

function renderProductos() {
  listaProductos.innerHTML = "";
  const texto = buscador.value.toLowerCase();

  productos.forEach(p => {
    if (!p.desc.toLowerCase().includes(texto)) return;

    listaProductos.innerHTML += `
      <div class="card">
        <img src="${p.img}" onclick="abrirImg('${p.img}')">
        <span class="badge">${p.precio} IP</span>
        <h3>${p.desc}</h3>
      </div>`;
  });
}

function abrirImg(src) {
  modalImg.src = src;
  modal.style.display = "flex";
}

/* ================= USUARIOS ================= */
db.collection("usuarios").onSnapshot(snap => {
  listaUsuarios.innerHTML = "";
  snap.forEach(doc => {
    const u = doc.data();
    listaUsuarios.innerHTML += `
      <tr>
        <td>${u.control}</td>
        <td>${u.nombre}</td>
        <td>${u.puntosActuales}</td>
        ${logeado ? `
          <td>${u.puntosAcumulados}</td>
          <td>${u.comentarios || ""}</td>
          <td>
            <button onclick="editarUsuario('${doc.id}')">‚úèÔ∏è</button>
            <button onclick="eliminarUsuario('${doc.id}')">üóëÔ∏è</button>
          </td>` : ""}
      </tr>`;
  });
});

function guardarUsuario() {
  const data = {
    control: controlUsuario.value,
    nombre: nombreUsuario.value,
    puntosAcumulados: +puntosAcumulados.value,
    puntosActuales: +puntosActuales.value,
    comentarios: comentariosUsuario.value
  };

  userId.value
    ? db.collection("usuarios").doc(userId.value).update(data)
    : db.collection("usuarios").add(data);

  cancelarUsuario();
}

function editarUsuario(id) {
  db.collection("usuarios").doc(id).get().then(d => {
    const u = d.data();
    userId.value = id;
    controlUsuario.value = u.control;
    nombreUsuario.value = u.nombre;
    puntosAcumulados.value = u.puntosAcumulados;
    puntosActuales.value = u.puntosActuales;
    comentariosUsuario.value = u.comentarios;
  });
}

function eliminarUsuario(id) {
  if (confirm("Eliminar usuario?"))
    db.collection("usuarios").doc(id).delete();
}

function cancelarUsuario() {
  userId.value = "";
  controlUsuario.value = "";
  nombreUsuario.value = "";
  puntosAcumulados.value = "";
  puntosActuales.value = "";
  comentariosUsuario.value = "";
}

/* ================= TABS ================= */
function mostrarSeccion(seccion, btn) {
  document.getElementById("seccion-premios").style.display = seccion === "premios" ? "block" : "none";
  document.getElementById("seccion-usuarios").style.display = seccion === "usuarios" ? "block" : "none";
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  btn.classList.add("active");
}
</script>

</body>
</html>




























