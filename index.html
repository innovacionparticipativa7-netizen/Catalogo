<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de Premios IP</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }

    input, button {
      padding: 6px;
      margin: 4px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    img {
      width: 80px;
      border-radius: 6px;
    }

    .admin-login {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 4px;
    }

    .admin-login input {
      width: 90px;
      font-size: 12px;
    }

    .admin {
      background: #f9f9f9;
      padding: 10px;
      margin-top: 15px;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>

<h2>Catálogo de Premios IP</h2>

<input type="text" id="buscador" placeholder="Buscar producto..." onkeyup="buscar()">

<!-- LOGIN ADMIN -->
<div class="admin-login">
  <input type="password" id="password" placeholder="Admin">
  <button onclick="login()">OK</button>
</div>

<!-- FORMULARIO -->
<div id="formulario" class="admin" style="display:none;">
  <h3>Agregar / Editar producto</h3>

  <input type="hidden" id="editIndex">

  <input type="text" id="descripcion" placeholder="Descripción"><br>
  <input type="number" id="disponible" placeholder="Disponible"><br>
  <input type="number" id="precio" placeholder="Punto IP"><br>
  <input type="text" id="imagen" placeholder="URL de la imagen"><br>

  <button onclick="guardarProducto()">Guardar</button>
  <button onclick="cancelarEdicion()">Cancelar</button>
</div>

<table>
  <thead>
    <tr>
      <th>Foto</th>
      <th>Descripción</th>
      <th>Disponible</th>
      <th>Punto IP</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="listaProductos"></tbody>
</table>

<script>
/* ================= ADMIN ================= */
const CONTRASENA = "1234";
let logeado = false;

function login() {
  if (password.value === CONTRASENA) {
    logeado = true;
    formulario.style.display = "block";
    alert("Acceso administrador concedido");
  } else {
    alert("Contraseña incorrecta");
  }
}

/* ================= BUSCADOR ================= */
function buscar() {
  let texto = buscador.value.toLowerCase();
  document.querySelectorAll("#listaProductos tr").forEach(fila => {
    fila.style.display = fila.textContent.toLowerCase().includes(texto) ? "" : "none";
  });
}

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyCfS-TI8g2KEUWQmCafvf-Ig4KtZa2o_W8",
  authDomain: "catalogo-ee5b7.firebaseapp.com",
  projectId: "catalogo-ee5b7",
  storageBucket: "catalogo-ee5b7.firebasestorage.app",
  messagingSenderId: "577362291946",
  appId: "1:577362291946:web:fe798c5e79e311a8967b93"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const listaProductos = document.getElementById("listaProductos");

/* ================= LEER PRODUCTOS (REAL TIME) ================= */
db.collection("productos").onSnapshot(snapshot => {
  listaProductos.innerHTML = "";
  snapshot.forEach(doc => {
    const p = doc.data();
    listaProductos.innerHTML += `
      <tr>
        <td><img src="${p.img}"></td>
        <td>${p.desc}</td>
        <td>${p.disp}</td>
        <td>${p.precio}</td>
        <td>
          <button onclick="editarProducto('${doc.id}')">Editar</button>
          <button onclick="eliminarProducto('${doc.id}')">Eliminar</button>
        </td>
      </tr>
    `;
  });
});

/* ================= CRUD ================= */
function guardarProducto() {
  if (!logeado) return;

  const producto = {
    desc: descripcion.value,
    disp: disponible.value,
    precio: precio.value,
    img: imagen.value
  };

  if (!producto.desc || !producto.disp || !producto.precio || !producto.img) {
    alert("Completa todos los campos");
    return;
  }

  if (editIndex.value === "") {
    db.collection("productos").add(producto);
  } else {
    db.collection("productos").doc(editIndex.value).update(producto);
  }

  limpiarFormulario();
}

function editarProducto(id) {
  if (!logeado) {
    alert("Acceso restringido");
    return;
  }

  db.collection("productos").doc(id).get().then(doc => {
    const p = doc.data();
    editIndex.value = id;
    descripcion.value = p.desc;
    disponible.value = p.disp;
    precio.value = p.precio;
    imagen.value = p.img;
  });
}

function eliminarProducto(id) {
  if (!logeado) {
    alert("Acceso restringido");
    return;
  }

  if (confirm("¿Eliminar producto?")) {
    db.collection("productos").doc(id).delete();
  }
}

function cancelarEdicion() {
  limpiarFormulario();
}

function limpiarFormulario() {
  descripcion.value = "";
  disponible.value = "";
  precio.value = "";
  imagen.value = "";
  editIndex.value = "";
}
</script>

</body>
</html>





